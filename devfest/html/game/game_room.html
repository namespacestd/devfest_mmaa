
{% extends "base_generic.html" %}
{% load staticfiles %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static "css/main.css" %}" />
    <link rel="stylesheet" type="text/css" href="{% static "css/lightbox.css" %}" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
{% endblock %}

{% block content %}
    {% include 'main/header.html' %}
    <div id="game-main">
        <div id="top-info"><span class="small">Game:</span> <span class="glow">{{ room_name }}</span> | <span class="small">Current Judge:</span> <span class="glow">{{ game_instance.current_judge.user.username }}</span> | <span class="small">Current Phrase:</span>
            {% if game_instance.current_phrase %}
                <span class="glow">{{game_instance.current_phrase}}</span>
            {% else %}
                <span class="glow">N/A</span>
            {% endif %}
        </div>
        <div id="game-left">
            <div id="game-tools"></div>
        </div>
        <div id="game-right">
            <div id="game-info" class="centered">
                <h1>Â» Players</h1>
                <table id="playerlist">
                    {% for user in userlist %}
                        <tr><td>{{ user.username }}</td> <td class="playerlist-right">{{ user.score.score }}</td></tr>
                    {% endfor %}
                </table>
                <div class="small-top-margin"></div>
                <a class="button" href="/">Back to Home</a>
                <a class="button" href="/game/leave_room/{{room_name}}/">Leave Game</a>
            </div>
            <div id="game-players"></div>
        </div>
        <div class="clear"></div>
    </div>

    <div class="top-margin">
        <div class="section_title"> Room: {{ room_name }} </div>
        <div class="section_title"> Current Judge: {{ game_instance.current_judge.user.username }} </div>
        <div class="section_title"> Is Public: {{game_instance.is_public}} </div>
        <div class="section_title"> Password: {{game_instance.password}} </div>
        <div class="section_title"> Current Phrase: {{game_instance.current_phrase}}</div>
        <div class="section_title"> Game Started: {{game_instance.game_started}}</div>
        <div class="section_title"> Max Players: {{game_instance.max_players}}</div>
        {% if open_slots %}
            {% if not game_instance.game_started and not already_in_game %}
                <form id="join_room_button" action="/game/room/join_game/{{room_name}}/" method="post">
                    {% csrf_token %}
                    {% if not game_instance.is_public %} 
                        This room is private. Please enter the password.
                        <input type="text" name="room_password" placeholder='Password' required></input>
                    {% endif %} 
                    <input type="submit" value="Join Room"> </input>
                </form>
            {% endif %}
        {% elif not already_in_game %}
            Sorry, max number of players in the room has been reached.
        {% endif %}
        <div id="current_room_users">
            <div class="content_title"> Current Users </div>
            {% for user in userlist %}
                <div class="game_entry"> {{ user.username }} ({{ user.score.score }}) </div>
            {% endfor %}
        </div>

        <div>
            {% if previous_round_data %}
                Round Results <br/>
                {% for drawing in previous_round_data %}
                    {{ drawing.user.user.username }}
                    <img src="/{{drawing.picture}}"></img>
                    {% if drawing.was_round_winner %}
                        THIS DRAWING WAS THE WINRAR
                    {% endif %}
                    <a href="/game/next_round/{{room_name}}/">Go to Next Round</a>
                    <br/>
                {% endfor %}
            {% else %}
                {% if game_over %}
                    The game has completed. See the final score total above.
                    <a href="/" class="button"> Return to Dashboard </a>
                {% else %}
                    {% if game_instance.game_started %}
                    <!-- Judge -->
                        {% if is_current_judge %}
                            {% if game_instance.current_phrase %}
                                People Drawing: {{ num_drawing }}
                                <form action="/game/judge_drawing/{{room_name}}/" method="post">
                                    {% csrf_token %}
                                    {% for drawing in user_drawings %}
                                        <div class="user_drawing">
                                            {{ drawing.username }} 
                                            <div class="drawing_image">
                                                {% if drawing.drawing %}
                                                    <a href="/{{drawing.drawing.picture}}" data-lightbox="user_drawing"><img src="/{{drawing.drawing.picture}}" width="150" height="150"/></a>
                                                {% else %}
                                                    Blank_image.png
                                                {% endif %}
                                                {% if all_submitted %}
                                                    <input type="submit" name="{{drawing.username}}" value="Choose this Drawing"></input>
                                                {% endif %}
                                            </div>
                                        </div>
                                    {% endfor %}
                                </form>
                            {% else %}
                                <form action="/game/judge_phrase/{{room_name}}/" method="post">
                                    {% csrf_token %}
                                    <input type="text" name="judge_phrase" placeholder="Enter Phrase Here"></input>
                                    <input type="submit" value="Submit Phrase"></input>
                                </form>
                            {% endif %}
                        {% else %}
                            {% if already_in_game %}
                                {% if not game_instance.current_phrase %}
                                    Judge has not yet chosen a phrase.
                                {% else %}
                                    {% if not user_drawing %}
                                        Draw Here
                                        <div id="red">Red</div>
                                        <div id="blue">Blue</div>
                                        <div id="clear">Clear</div>
                                        <div id="opacity"></div>
                                        <div id="thickness"></div>
                                        <div id="sketch">
                                            <canvas id="paint"></canvas>
                                        </div>
                                        <form id="submit-drawing-form" action="/game/submit_drawing/{{room_name}}/" method="POST">
                                            {% csrf_token %}
                                            <input type="hidden" name="image_data" id="image_data"></input>
                                            <input id="submit-drawing" type="submit" class="button"></input>
                                        </form>
                                                <!-- <form action="/game/submit_drawing/{{room_name}}/" method="post" enctype="multipart/form-data">
                                                    {% csrf_token %}
                                                    <input name="drawn_image" type="file" required> </input>
                                                    <input type="submit" value="Submit"> </input>
                                                </form> -->
                                    {% else %}
                                        Your Drawing is Beautiful.
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    {% elif is_owner %}
                        {% if game_startable %}
                            <a href="/game/start_game/{{room_name}}/" class='button'>Start Game</a>
                        {% else %}
                            Waiting for more players...
                        {% endif %}
                    {% else %}
                        Waiting for owner to start game...
                    {% endif %}
                {% endif %}
                <!-- Leave Room -->
                <br>
                <a class="button" href="/game/leave_room/{{room_name}}/">Leave Game</a>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block js %}
    {% if not is_current_judge %}
        <script src="/static/js/canvas.js"></script>
    {% else %}
        <script src="/static/js/lightbox-2.6.min.js"></script>
    {% endif %}
{% endblock %}
